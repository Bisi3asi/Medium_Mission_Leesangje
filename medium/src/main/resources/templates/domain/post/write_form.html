<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>New Story - medium-mission</title>
    <!-- import global.css-->
    <link rel="stylesheet" href="/global.css">
    <!-- import fontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
</head>
<body class="bg-white">
<!-- import daisyUI -->
<link href="https://cdn.jsdelivr.net/npm/daisyui@4.0.8/dist/full.min.css" rel="stylesheet" type="text/css"/>
<!-- import tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<div class="bg-white text-black">
    <!-- navbar -->
    <form th:action="@{/post/write}" th:object="${postRequestDto}" method="post" enctype="multipart/form-data">
        <!-- error -->
        <div th:if="${#fields.hasAnyErrors()}">
            <div class="toast toast-top toast-end mt-20">
                <div th:each="error : ${#fields.allErrors()}" class="alert alert-error mb-1">
                    <span th:text="${error}"></span>
                </div>
            </div>
        </div>

        <div class="navbar">
            <div class="dropdown flex-none">
                <button class="btn btn-square btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         class="inline-block w-5 h-5 stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-white w-52">
                    <li><a href="/">최신 게시글</a></li>
                    <li><a href="/post/list">모든 게시글</a></li>
                </ul>
            </div>
            <div class="flex-1 font-bold">
                <a href="/" class="btn btn-ghost btn-lg text-2xl font-bold">MEDIUM</a>
                <span class="mr-2">By</span>
                <span th:text="${currentUser.username}"></span>
            </div>
            <input class="mr-16 flex-none btn btn-success" type="submit" value="등록하기">
        </div>

        <!-- form -->
        <div class="px-20 bg-white">
            <div class="form-control mx-auto mb-2">
                <label class="label cursor-pointer">

                    <span class="label-text flex items-center">
                        <input type="checkbox"
                               class="checkbox checkbox-success checkbox-sm mr-2"
                               checked="checked"
                               th:field="*{published}"
                        />
                        게시글을 공개하겠습니다
                    </span>
                    <span class="label-text-alt" id="titleInputCount">0 / 50</span>
                </label>
                <textarea class="form-input w-full p-4 bg-white text-black text-3xl" id="titleTextInput" maxlength=50
                          placeholder="글 제목" rows="2"
                          th:field="*{title}"></textarea>
            </div>
            <div class="form-control mx-auto">
            <textarea class="form-input w-full p-4 bg-white text-black" id="contentTextInput" maxlength=1000
                      placeholder="글 내용" rows="20"
                      th:field="*{content}"></textarea>
                <label class="label">
                    <span class="label-text"></span>
                    <span class="label-text-alt" id="contentInputCount">0 / 1000</span>
                </label>
            </div>
            <div class="pb-10 flex items-center">
                <div class="btn btn-ghost mr-1">
                    <label for="file"><i class="fa-solid fa-circle-plus fas fa-3x"></i></label>
                    <input type="file" id="file" class="hidden"
                           th:field="*{multipartFile}"
                           accept=".jpg, .jpeg, .png"
                           onchange="displayFileName()"/>
                </div>
                <div>
                    <div id="fileNameContainer" style="color: black;">미리보기 이미지를 등록해보세요!</div>
                    <div class="label-text-alt">미리보기 이미지는 1개만 등록 가능하며, 이미지는 jpg, jpeg, gif, png 확장자를 지원합니다.</div>
                </div>
            </div>
        </div>
    </form>
</div>
<script>
    const titleTextarea = document.getElementById('titleTextInput');
    const titleCharCountSpan = document.getElementById('titleInputCount');
    const contentTextarea = document.getElementById('contentTextInput');
    const contentCharCountSpan = document.getElementById('contentInputCount');

    function updateCharCount(textarea, charCountSpan, maxLength) {
        const currentLength = textarea.value.length;
        charCountSpan.textContent = `${currentLength} / ${maxLength}`;
    }

    // title
    titleTextarea.addEventListener('input', function () {
        updateCharCount(titleTextarea, titleCharCountSpan, 50);
    });

    // content
    contentTextarea.addEventListener('input', function () {
        updateCharCount(contentTextarea, contentCharCountSpan, 1000);
    });

    // 파일이 선택되었을 때 파일 이름을 표시
    function displayFileName() {
        var fileInput = document.getElementById('file');
        var fileNameContainer = document.getElementById('fileNameContainer');

        if (fileInput.value) {
            fileNameContainer.innerHTML = 'File Selected: ' + fileInput.files[0].name;
            fileNameContainer.style.color = 'green';
        } else {
            fileNameContainer.innerHTML = 'Add Preview Image';
            fileNameContainer.style.color = 'black';
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        var messageDiv = document.querySelector('.toast.toast-top.toast-end');

        if (messageDiv) {
            setTimeout(function () {
                messageDiv.classList.add('fade-out');
                setTimeout(function () {
                    messageDiv.style.display = 'none';
                }, 3000);
            }, 3000);
        }
    });
</script>
</body>
