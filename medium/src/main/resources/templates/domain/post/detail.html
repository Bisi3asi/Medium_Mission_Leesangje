<html lang="ko" layout:decorate="~{global/layout}">
<head>
    <title>Medium-Mission</title>
</head>
<body>
<div layout:fragment="content">
    <!-- title container -->
    <div class="w-full bg-white">
        <div class="py-24 px-20 pb-2 text-black font-bold">
            <div class="flex items-center">
                <div class="mr-2" th:unless="${post.published}">
                    <i class="fa-solid fa-lock fas fa-5xl" style="color: black;"></i>
                </div>
                <div class="mb-6 text-5xl" th:text="${post.title}"></div>
            </div>
            <div class="text-xl"></div>
            <div class="mb-6 text-gray-400">
                <div class="pt-1 mr-1 flex items-center">
                    <a th:href="@{|/b/${post.author.username}|}">
                        <div class="mr-2 btn btn-ghost">
                            <i class="fa-solid fa-user fas fa-2xl" style="color: black;"></i>
                        </div>
                    </a>
                    <div>
                        <div class="text-xl" th:text="${post.author.username}"></div>
                        <div class="flex text-base">
                            <div class="mr-1" th:text="${post.viewCount + ' min read'}"></div>
                            <div class="mr-1">·</div>
                            <div th:text="${#temporals.format(post.createDate, 'yyyy.MM.dd')}"></div>
                        </div>
                    </div>
                    </a>
                    <div class="dropdown dropdown-right">
                        <div tabindex="0" role="button" class="btn btn-ghost m-1"><i class="fa-solid fa-ellipsis"></i>
                        </div>
                        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-400 w-40">
                            <li><a th:href="@{'/post/' + ${post.id} + '/modify'}">Update Post</a></li>
                            <li>
                                <form th:action="@{'/post/' + ${post.id} + '/delete'}" th:method="delete">
                                    <input type="hidden" name="_method" value="delete"/>
                                    <button type="submit" onclick="return confirmDelete();">
                                        Delete Post
                                </form>
                                <!--<a th:href="@{'/post/' + ${post.id} + '/delete'}">Delete Post</a>-->
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- content -->
    <div class="flex items-center w-full h-14 px-20 border-b-2 border-gray-400">
        <div class="mr-2">
            <i class="fa-solid fa-hands-clapping" style="color: white;"></i>
        </div>
        <div class="mr-7">2K</div>
        <div class="mr-2">
            <i class="fa-solid fa-comment" style="color: white;"></i>
        </div>
        <div th:text="${post.commentList.size}"></div>
    </div>
    <div class="px-20 mt-10 pb-32 text-2xl border-b-2 border-gray-400" th:text="${post.content}"></div>

    <!-- comment -->
    <div class="px-20 border-b-2 border-gray-400 bg-gray-700">
        <ul th:each="comment : ${post.commentList}">
            <li class="py-2 text-xl">
                <div class="text-gray-400">
                    <div class="pt-1 mr-1 mb-2 flex items-center">
                        <a th:href="@{|/b/${comment.author.username}|}">
                            <div class="mr-2 btn btn-ghost">
                                <i class="fa-solid fa-user fas fa-2xl" style="color: white;"></i>
                            </div>
                        </a>
                        <div>
                            <div class="text-xl" th:text="${comment.author.username}"></div>
                            <div class="flex text-base">
                                <div th:text="${#temporals.format(comment.createDate, 'yyyy.MM.dd')}"></div>
                            </div>
                        </div>
                        <div class="dropdown dropdown-right">
                            <div th:attr="tabindex=0, role='button'" class="btn btn-ghost m-1">
                                <i class="fa-solid fa-ellipsis"></i></div>
                            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-400 w-44">
                                <li><a href="@{|/comment/${comment.id}/modify}|}">Update Comment</a></li>
                                <li><a href="@{/comment/${comment.id}/delete}|}">Delete Comment</a></li>
                            </ul>
                        </div>
                    </div>
                    <div th:text="${comment.content}" class="mb-2"></div>
                    <div class="flex items-center w-full h-10 text-lg">
                        <div class="mr-2">
                            <i class="fa-solid fa-hands-clapping" style="color: white;"></i>
                        </div>
                        <div class="mr-7">2K</div>
                        <div class="mr-2">
                            <i class="fa-solid fa-comment" style="color: white;"></i>
                        </div>
                        <div th:text="${post.commentList.size}"></div>
                    </div>
                </div>
            </li>
        </ul>
        <!-- comment form -->
        <label class="form-control">
            <div class="label">
                <span class="label-text">&nbsp;</span>
                <span class="label-text-alt" id="charCount">0 / 300</span>
            </div>
            <textarea class="textarea textarea-lg textarea-primary"
                      id="textInput"
                      maxlength="300" rows="6"
                      placeholder="What are your thoughts?"></textarea>
            <div class="label">
                <span class="flex justify-items-center">
                    <input type="checkbox" checked="checked" class="checkbox mr-2"/>
                    <span>Also publish to my profile</span>
                </span>
                <span class="label-text-alt">
                    <div class="btn btn-primary h-12">Respond</div>
                </span>
            </div>
        </label>
    </div>
</div>
<th:block layout:fragment="script">
    <script> // comment form 글자수 세기 script
    document.addEventListener("DOMContentLoaded", function () {
        const textarea = document.getElementById('textInput');
        const charCountSpan = document.getElementById('charCount');

        textarea.addEventListener('input', function () {
            const currentLength = textarea.value.length;
            const maxLength = 300;

            charCountSpan.textContent = `${currentLength} / ${maxLength}`;

            if (currentLength > maxLength) {
                charCountSpan.classList.add('text-red-500');
            } else {
                charCountSpan.classList.remove('text-red-500');
            }
        });
    });

    function confirmDelete() {
        var result = confirm('Are you sure delete your post?');
        if (result) {
            return true;
        } else {
            return false;
        }
    }
    </script>
</th:block>
</body>
</html>